<div>
    <input type="text" id="search-input" placeholder="Zadej název knihy...">
    <button onclick="searchBooks()">Hledat</button>
</div>

<div id="results"></div>

<script>
    async function searchBooks() {
        const query = document.getElementById('search-input').value;
        if (!query) return;

        const res = await fetch(`https://openlibrary.org/search.json?q=${encodeURIComponent(query)}&limit=20`);
        const data = await res.json();

        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '';

        if (!data.docs || data.docs.length === 0) {
            resultsDiv.innerHTML = 'Nebyly nalezeny žádné knihy.';
            return;
        }

        data.docs.forEach(doc => {
            const title = doc.title || 'Neznámý název';
            const author = doc.author_name ? doc.author_name.join(', ') : 'Neznámý autor';
            const coverId = doc.cover_i;
            const image = coverId
                ? `https://covers.openlibrary.org/b/id/${coverId}-M.jpg`
                : 'https://via.placeholder.com/128x192?text=No+Cover';

            const card = document.createElement('div');
            card.style = 'border: 1px solid #ccc; padding: 10px; margin: 10px; display: inline-block; width: 200px; vertical-align: top;';
            card.innerHTML = `
                <img src="${image}" style="width: 100%; height: auto; margin-bottom: 10px;">
                <h4 style="margin: 5px 0;">${title}</h4>
                <p style="font-size: 0.9em; color: #666;">${author}</p>
                <button onclick="saveBook('${title.replace(/'/g, "\\'")}', '${author.replace(/'/g, "\\'")}', '${image}')">Vybrat</button>
            `;
            resultsDiv.appendChild(card);
        });
    }

    async function saveBook(title, author, image) {
        const res = await fetch('/api/books', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title, author, image })
        });

        if (res.ok) {
            window.location.href = '/';
        } else {
            alert('Chyba při ukládání knihy.');
        }
    }
</script>